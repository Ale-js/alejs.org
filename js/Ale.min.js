/*! Ale.js JavaScript Framework
 * Version: 0.3
 * (c) 2018 Dong Yingxuan (Bill Dong) - China
 * Released under the MIT License
 */
(function(g,i){var f={};g.Ale={};Ale.version="0.3";if(String.prototype.trim===undefined){String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}Ale.data=function(j,A){if(typeof j==="string"&&typeof A==="object"){var w,u,m,k,v,p,l,n,q,t,y,r,o=i.querySelectorAll(j);for(var s=0;s<o.length;s++){w=o[s];k=w.children;for(var z=0;z<k.length;z++){if(k[z].getAttribute("a-for")!==null){v=k[z].getAttribute("a-for").split("in")[0].trim(),p=k[z].getAttribute("a-for").split("in")[1].trim();if(Array.isArray(A[p])&&A[p].length!==0){l=k[z].innerHTML,n={},q=i.createElement(k[z].tagName.toLowerCase());for(var x=0;x<A[p].length;x++){n[v]=A[p][x];t=i.createElement(k[z].tagName.toLowerCase());t.innerHTML=c(l,n);t=a(t,A[p][x]);q.innerHTML+="<"+k[z].tagName.toLowerCase()+">"+t.innerHTML+"</"+k[z].tagName.toLowerCase()+">"}o[s].innerHTML=q.innerHTML}}}w.innerHTML=c(w.innerHTML,A)}}else{throw"Ale.js: Wrong data type! In function data."}};Ale.define=function(j){if(typeof j==="object"&&!Array.isArray(j)){if(typeof j.name==="string"&&typeof j.template==="string"&&f[j.name]===undefined){f[j.name]=[j.template,j.parameters];if(Array.isArray(j.state)){f[j.name].push(j.state)}else{f[j.name].push(undefined)}if(typeof j.life==="object"&&!Array.isArray(j.life)){f[j.name].push({});if(j.life.Using){f[j.name][3].Using=j.life.Using}if(j.life.Mounting){f[j.name][3].Mounting=j.life.Mounting}if(j.life.Rendering){f[j.name][3].Rendering=j.life.Rendering}if(j.life.Unmounting){f[j.name][3].Unmounting=j.life.Unmounting}if(j.life.Destroy){f[j.name][3].Destroy=j.life.Destroy}}else{f[j.name].push(undefined)}if(typeof j.permissions==="object"&&!Array.isArray(j.permissions)){f[j.name].push(j.permissions)}else{f[j.name].push(undefined)}}else{throw"Ale.js: The data type is wrong or the necessary data is missing! In function define."}}else{throw"Ale.js: Wrong data type! In function define."}};Ale.use=function(m){if(typeof m==="object"&&!Array.isArray(m)){if(typeof m.name==="string"&&typeof m.el==="string"&&f[m.name]!==undefined){var q={},k,l,o,p;if(f[m.name][3]!==undefined&&typeof f[m.name][3].Using==="function"){f[m.name][3].Using()}if(f[m.name][3]!==undefined&&typeof f[m.name][3].Rendering==="function"){f[m.name][3].Rendering()}if(typeof f[m.name][1]==="object"&&!Array.isArray(f[m.name][1])){q=e(f[m.name][1])}if(typeof m.parameters==="object"&&!Array.isArray(m.parameters)){for(var n in m.parameters){q[n]=m.parameters[n]}}p=new d(f[m.name][0],q,f[m.name][2],f[m.name][3],f[m.name][4]);k=c(f[m.name][0],q),l=i.querySelectorAll(m.el);if(typeof m.events==="object"&&!Array.isArray(m.events)){for(var n=0;n<l.length;n++){p.el.push(l[n]);l[n].innerHTML=k;for(var j in m.events){l[n]["on"+j]=m.events[j]}}}else{for(var n=0;n<l.length;n++){p.el.push(l[n]);l[n].innerHTML=k}}if(f[m.name][3]!==undefined&&typeof f[m.name][3].Mounting==="function"){f[m.name][3].Mounting()}return p}else{throw"Ale.js: The data type is wrong or the necessary data is missing! In function use."}}else{throw"Ale.js: Wrong data type! In function use!"}};function a(j,o){var k=j.children,m,l,t,s,p;for(var n=0;n<k.length;n++){if(k[n].getAttribute("a-for")!==null){l=k[n].getAttribute("a-for").split("in")[1].trim().split("."),t=o,s=k[n].innerHTML,p=i.createElement(k[n].tagName.toLowerCase());for(var r=0;r<l.length;r++){t=t[l[r]]}for(var q=0;q<t.length;q++){m={};m[k[n].getAttribute("a-for").split("in")[0].trim()]=t[q];thisNowEl=i.createElement(k[n].tagName.toLowerCase());thisNowEl.innerHTML=c(s,m);thisNowEl=a(thisNowEl,t[q]);p.innerHTML+="<"+k[n].tagName.toLowerCase()+">"+thisNowEl.innerHTML+"</"+k[n].tagName.toLowerCase()+">"}j.innerHTML=p.innerHTML}else{if(k[n].children.length>0){k[n]=a(k[n],o)}}}return j}function b(l,j){function k(n){j._super=this;var m=arguments.length;return m?m>1?l.apply(j,arguments):l.call(j,n):l.call(j)}k._length=l.length;return k}function d(k,o,n,m,j){this.el=[];this.tem=k;this.obj=o;this.state=n;this.nowState=0;this.life=m;this.permission=j;if(this.life!==undefined){for(var l in this.life){this.life[l]=b(this.life[l],this)}}this.destroy=function(){for(var p=0;p<this.el.length;p++){this.el[p].innerHTML=""}if(this.life!==undefined&&typeof this.life.Unmounting==="function"){this.life.Unmounting()}var q=this.life;for(var p in this){this[p]=undefined}if(q!==undefined&&typeof q.Destroy==="function"){q.Destroy()}};this.changeState=function(r){if(this.permission!==undefined&&typeof this.permission.changeState==="boolean"){if(!this.permission.changeState){throw"Ale.js: Operations are not allow! (no permission)"}}if(this.life!==undefined&&typeof this.life.Rendering==="function"){this.life.Rendering()}for(var q in r){this.obj[q]=r[q]}var p=c(this.tem,this.obj);for(var q=0;q<this.el.length;q++){this.el[q].innerHTML=p}};this.nextState=function(){if(this.permission!==undefined&&typeof this.permission.nextState==="boolean"){if(!this.permission.nextState){throw"Ale.js: Operations are not allow! (no permission)"
}}if(this.state!==undefined&&this.state[this.nowState]!==undefined){if(this.life!==undefined&&typeof this.life.Rendering==="function"){this.life.Rendering()}var p=c(this.tem,this.state[this.nowState]);for(var q=0;q<this.el.length;q++){this.el[q].innerHTML=p}this.nowState++;return true}else{return false}};this.addState=function(p){if(this.permission!==undefined&&typeof this.permission.addState==="boolean"){if(!this.permission.addState){throw"Ale.js: Operations are not allow! (no permission)"}}if(Array.isArray(p)){if(this.state===undefined){this.state=[]}this.state=this.state.concat(p)}else{throw"Ale.js: Wrong data type! In function addState!"}};this.removeState=function(){if(this.permission!==undefined&&typeof this.permission.removeState==="boolean"){if(!this.permission.removeState){throw"Ale.js: Operations are not allow! (no permission)"}}if(this.state!==undefined){if(this.state.length>0&&this.nowState<this.state.length){this.state.splice(this.state.length-1,1);return true}else{return false}}else{throw"Ale.js: State is not created!"}};this.setState=function(p){if(this.permission!==undefined&&typeof this.permission.setState==="boolean"){if(!this.permission.setState){throw"Ale.js: Operations are not allow! (no permission)"}}if(Array.isArray(p)){this.state=p;this.nowState=0}else{throw"Ale.js: Wrong data type! In function setState!"}};this.backState=function(){if(this.permission!==undefined&&typeof this.permission.backState==="boolean"){if(!this.permission.backState){throw"Ale.js: Operations are not allow! (no permission)"}}if(this.state!==undefined&&this.state[this.nowState-2]!==undefined){this.nowState--;if(this.life!==undefined&&typeof this.life.Rendering==="function"){this.life.Rendering()}var p=c(this.tem,this.state[this.nowState-1]);for(var q=0;q<this.el.length;q++){this.el[q].innerHTML=p}return true}else{return false}};this.allState=function(){if(this.state!==undefined){return this.state.length}}}function e(l){if(l===null){return null}if(typeof l!=="object"){return l}if(l.constructor===Date){return new Date(l)}if(l.constructor===RegExp){return new RegExp(l)}var j=new l.constructor();for(var k in l){if(l.hasOwnProperty(k)){var m=l[k];j[k]=typeof m==="object"?arguments.callee(m):m}}return j}function c(p,n){var m,k,j,l;p=p.replace(/\n/g,"").replace(/\r/g,""),m=p.match(/(?<=\{\{).*?(?=\}\})/g);if(m===null){return p}for(var o=0;o<m.length;o++){j=m[o];if(m[o].substr(0,2)==="=!"){m[o]=m[o].substr(2);m[o]=m[o].trim();for(var r in n){m[o]=h(r,n[r],m[o])}try{m[o]=new Function("return "+m[o])()}catch(q){m[o]="{{="+m[o]+"}}"}if(typeof m[o]==="object"&&!Array.isArray(m[o])){m[o]=JSON.stringify(m[o])}m[o]=m[o].replace(/</g,"&lt;").replace(/>/g,"&gt;");j=j.replace(/\\/g,"\\\\").replace(/\?/,"\\?").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\*/g,"\\*").replace(/\+/g,"\\+").replace(/\-/g,"\\-").replace(/\//g,"\\/").replace(/\$/g,"\\$").replace(/\[/g,"\\[").replace(/\]/g,"\\]");k=new RegExp("{{"+j+"}}","g");p=p.replace(k,m[o])}else{if(m[o].substr(0,1)==="="){m[o]=m[o].substr(1);m[o]=m[o].trim();for(var r in n){m[o]=h(r,n[r],m[o])}try{m[o]=new Function("return "+m[o])()}catch(q){m[o]="{{="+m[o]+"}}"}if(typeof m[o]==="object"&&!Array.isArray(m[o])){m[o]=JSON.stringify(m[o])}j=j.replace(/\\/g,"\\\\").replace(/\?/,"\\?").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\*/g,"\\*").replace(/\+/g,"\\+").replace(/\-/g,"\\-").replace(/\//g,"\\/").replace(/\$/g,"\\$").replace(/\[/g,"\\[").replace(/\]/g,"\\]");k=new RegExp("{{"+j+"}}","g");p=p.replace(k,m[o])}else{m[o]=m[o].trim();for(var r in n){m[o]=h(r,n[r],m[o])}new Function(m[o])();j=j.replace(/\\/g,"\\\\").replace(/\?/,"\\?").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\*/g,"\\*").replace(/\+/g,"\\+").replace(/\-/g,"\\-").replace(/\//g,"\\/").replace(/\$/g,"\\$").replace(/\[/g,"\\[").replace(/\]/g,"\\]");k=new RegExp("{{"+j+"}}","g");p=p.replace(k,"")}}}return p}function h(j,m,k){var l=new RegExp("\\$"+j+"\\$","g");if(typeof m==="string"){m=m.replace(/\"/g,'\\"');k=k.replace(l,'"'+m+'"')}else{if(typeof m==="object"&&!Array.isArray(m)){k=k.replace(l,JSON.stringify(m))}else{if(Array.isArray(m)){compileArrStr='"[';for(var n=0;n<m.length;n++){compileArrStr+='\\"'+m[n].replace(/\"/g,'\\"')+'\\",'}compileArrStr=compileArrStr.substr(0,compileArrStr.length-1);compileArrStr+=']"';k=k.replace(l,compileArrStr)}else{if(typeof m==="function"){m=m(),k=h(j,m,k)}else{m=String(m).replace(/\"/g,'\\"');k=k.replace(l,'"'+m+'"')}}}}return k}})(window,document);
